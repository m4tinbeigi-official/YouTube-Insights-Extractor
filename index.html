// بازنویسی پروژه استخراج ویدیوهای یوتیوب با قابلیت‌های جدید و ریسپانسیو

// HTML: قالب اصلی صفحه
const templateHTML = `
<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحلیل‌گر یوتیوب</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazir', sans-serif;
            padding: 20px;
        }
        .video-item {
            margin-bottom: 15px;
        }
        .video-thumbnail {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center my-4">تحلیل‌گر ویدیوهای یوتیوب</h1>
        <div class="mb-3">
            <label for="apiKeyInput" class="form-label">کلید API یوتیوب:</label>
            <input type="text" id="apiKeyInput" class="form-control" placeholder="کلید API خود را وارد کنید">
        </div>
        <div class="mb-3">
            <label for="channelInput" class="form-label">شناسه یا لینک کانال:</label>
            <input type="text" id="channelInput" class="form-control" placeholder="شناسه یا لینک کانال را وارد کنید">
        </div>
        <button id="fetchVideosButton" class="btn btn-primary w-100">استخراج ویدیوها</button>

        <div id="videoList" class="mt-4"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>`;

// JavaScript: منطق برنامه
const script = `
// استخراج شناسه کانال از لینک یا شناسه وارد شده
function extractChannelId(input) {
    const regex = /channel\\/([\\w\\-]+)/;
    const match = input.match(regex);
    return match ? match[1] : input;
}

// گرفتن اطلاعات ویدیوها از یوتیوب
async function fetchVideos(apiKey, channelId) {
    const youtubeAPI = "https://www.googleapis.com/youtube/v3";
    try {
        // گرفتن شناسه لیست آپلودها
        const channelResponse = await axios.get(`${youtubeAPI}/channels`, {
            params: {
                part: "contentDetails",
                id: channelId,
                key: apiKey,
            },
        });
        const uploadsPlaylistId = channelResponse.data.items[0].contentDetails.relatedPlaylists.uploads;

        let nextPageToken = "";
        const videos = [];

        // گرفتن ویدیوها با صفحات بعدی
        do {
            const playlistResponse = await axios.get(`${youtubeAPI}/playlistItems`, {
                params: {
                    part: "snippet",
                    playlistId: uploadsPlaylistId,
                    maxResults: 50,
                    pageToken: nextPageToken,
                    key: apiKey,
                },
            });

            playlistResponse.data.items.forEach((item) => {
                const videoId = item.snippet.resourceId.videoId;
                const videoTitle = item.snippet.title;
                const thumbnailUrl = item.snippet.thumbnails.medium.url;
                videos.push({ id: videoId, title: videoTitle, thumbnail: thumbnailUrl });
            });

            nextPageToken = playlistResponse.data.nextPageToken;
        } while (nextPageToken);

        return videos;
    } catch (error) {
        console.error("Error fetching videos:", error);
        return [];
    }
}

// نمایش ویدیوها در صفحه
function displayVideos(videos) {
    const videoList = document.getElementById("videoList");
    videoList.innerHTML = "";

    if (videos.length === 0) {
        videoList.innerHTML = '<div class="alert alert-warning">هیچ ویدیویی یافت نشد!</div>';
        return;
    }

    videos.forEach((video) => {
        const videoItem = document.createElement("div");
        videoItem.classList.add("video-item", "card", "p-3");

        videoItem.innerHTML = `
            <img src="${video.thumbnail}" alt="${video.title}" class="video-thumbnail">
            <h5 class="mt-3">${video.title}</h5>
            <a href="https://www.youtube.com/watch?v=${video.id}" target="_blank" class="btn btn-primary">مشاهده ویدیو</a>
        `;

        videoList.appendChild(videoItem);
    });
}

// رویداد کلیک دکمه
document.getElementById("fetchVideosButton").addEventListener("click", async () => {
    const apiKey = document.getElementById("apiKeyInput").value;
    const channelInput = document.getElementById("channelInput").value;

    if (!apiKey || !channelInput) {
        alert("لطفاً تمام فیلدها را پر کنید!");
        return;
    }

    const channelId = extractChannelId(channelInput);
    const videos = await fetchVideos(apiKey, channelId);
    displayVideos(videos);
});
`;

// فایل HTML و جاوااسکریپت را ذخیره یا نمایش دهید
console.log(templateHTML);
console.log(script);
